---
layout: search
title: Gene Search
web_components: true
---
  
  
  <form>
    <div class="uk-margin">
        <h3>Sequence Variant Search</h3>
    </div>
    <div>
        <div>
            <label class="uk-form-label" for="form-stacked-text">Select a variant collection</label>
        </div>
        <select class="uk-select uk-form-width-large" id="variant-collection">
        </select>
        <div style="margin-left: 10px; margin-top: 5px">
            Synopsis: <span id="collection-synopsis"></span>
        </div>
    </div>
    <div class="uk-margin">
        <div>
            <label class="uk-form-label" for="form-stacked-text">Enter gene ID and size of left and right flanking regions...</label>
        </div>
        <input class="uk-input uk-form-width-large" type="text" id="gene-name" placeholder="Enter gene name"></input>
        <input class="uk-input uk-form-width-medium" type="text" id="flank-region"  placeholder="Enter flanking region"></input>
    </div>
    <div class="uk-margin">
        <div>
            <label class="uk-form-label" for="form-stacked-text">... or a genomic region, as a chromosome: start-end.</label>
        </div>
    <div>
        <div><input class="uk-input uk-form-width-small" type="text" id="start-end" rows="10" cols="30" placeholder="Start-End"></input></div>
    </div>
    <input class="uk-button uk-margin" uk-toggle="target: #modal" id="submit" type="button" value="Search" onclick="getData()" style="margin-top: 10px;"/>
    </div>
  </form>
    <div id="modal" uk-modal bg-close="false">
        <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title"></h2>
                <div id="modal-body">
                    <table id="variant-table uk-table-striped" class="uk-table uk-table-divider">
                        <caption>Search Results for <span id="modal-title"></span></caption>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Position</th>
                                <th>Alleles</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="data-row">
                                <td id="id"></td>
                                <td id="position"></td>
                                <td id="alleles"></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            <button class="uk-button uk-modal-close" type="button" onclick="deleteRow()">Close</button>
        </div>
    </div>

  <script >

//=========================================================================================
//              TEST DATA
//=========================================================================================
const variantCollectionArray = [ 
            {
                name: '--',
                description: ''
            },
            {
                name:'glyma.Wm82.gnm2.div.Song_Hyten_2015.vcf.gz',
                description: "VCF and HapMap files containing genotype information of the whole U.S. soybean germplasm collection using the SoySNP50K BeadChip."
            },
            {
                name: 'glyma.Wm82.gnm2.div.Torkamaneh_Laroche_2017.SNPdata.vcf.gz', 
                description: ''},
            {
                name: 'glyma.Wm82.gnm2.div.Torkamaneh_Laroche_2019.NonSynSNPs.vcf.gz',
                description: ''
            },
            {
                name: 'glyma.Wm82.gnm2.div.Torkamaneh_Laroche_2019.SNPdata.vcf.gz',
                description: ''
            },
            {
                name: 'glyma.Wm82.gnm2.div.Valliyodan_Brown_2021.USB481.vcf.gz',
                description: ''
            },
            {
                name: 'glyma.Wm82.gnm2.div.Wickland_Battu_2017.SNPdata1.vcf.gz',
                description: ''
            },
            {
                name: 'glyma.Wm82.gnm2.div.Wickland_Battu_2017.SNPdata2.vcf.gz',
                description: ''
            },
            {
                name: 'glyma.Wm82.gnm2.div.Wickland_Battu_2017.SNPdata3.vcf.gz',
                description: ''
            },
            {
                name: 'glyma.Wm82.gnm2.div.Zhang_Jiang_2020.SNPdata_full.vcf.gz',
                description: ''
            },
            {
                name: 'glyma.Wm82.gnm2.div.Zhang_Jiang_2020.SNPdata_maf01.vcf.gz',
                description: ''
            }
        ]
//=========================================================================================
//=========================================================================================


let variantCollection = document.getElementById("variant-collection")
let synopsis = ''
function onChange(){
    let value = variantCollection.value
    console.log(value)
    variantCollectionArray.forEach(collection =>{
        if(value === collection.name){
            synopsis = collection.description
        }
        console.log(synopsis)
        document.getElementById("collection-synopsis").innerHTML = 
        `
        <span>${synopsis}</span>
        `
    })
}
variantCollection.onchange = onChange
onChange()



function deleteRow() {
    window.location.reload();
}

function displayVariantCollection(){      
        variantCollectionArray.map(collection => {
            document.getElementById('variant-collection').innerHTML +=
            `
                <option value=${collection.name}>${collection.name}</option>
            `
        })
        }

        displayVariantCollection()



async function getData() {

  const geneName = document.getElementById("gene-name").value;
  let geneNames = geneName.split(",");
  let geneNamesString = "";

  geneNames.forEach(name => {
    geneNamesString += `"${name}",`;
  })

  geneNamesString = geneNamesString.slice(0, -1).replace(/\s/g, '');
  console.log("string: ", geneNamesString)

  // --------------------------
  // api call
  // --------------------------
  let myHeaders = new Headers();
  myHeaders.append("Content-Type", "text/plain");
  let searchString = `{"genes":[${geneNamesString}]}`;

  let requestOptions = {
    method: 'POST',
    headers: myHeaders,
    body: searchString,
    redirect: 'follow'
  };

  await fetch("https://gcv.soybase.org/microservices/soybase/genes", requestOptions)
    .then(response =>{
        if(!response.ok){
            throw error
        }
        return response.json()})
    .then(result => {
      console.log(result)
      let chromosomeArray = result.genes[0].chromosome.split('.')
      let collectionName = `${chromosomeArray[1]}.${chromosomeArray[2]}`
      console.log("line 84",collectionName)
      let chromosome = result.genes[0].chromosome
      let start = result.genes[0].fmin
      let stop = result.genes[0].fmax


     document.getElementById("modal-title").innerHTML = `
     <span uk-tooltip=${result.genes[0].chromosome}>${result.genes[0].name}</span>
     `

        getDataFromFastA(chromosome,collectionName,start,stop);
    })
    .catch(error => console.log('error', error));


    function getDataFromFastA(chromosome,collectionName,start,stop) {
         //let chromosome = "glyma.Wm82.gnm4.Gm01"
         let collection = `${collectionName}.div.Song_Hyten_2015`  //HOW TO KNOW WHAT COLLECTION?
         //let start = 1
         //let stop = 100000
        let url = `https://app.soybase.org/api/fasta-api/vcf/fetch/${chromosome}:${start}-${stop}/https://data.legumeinfo.org/Glycine/max/diversity/${collection}/glyma.${collection}.vcf.gz`
        let requestOptionsVariants = {
        method: 'GET',
        redirect: 'follow',
        headers: {
            "Accept": "application/json"
        }
        };

        fetch(url, requestOptionsVariants)
        .then(response => response.json())
        .then(result => {
            console.log("variants: ",result)
 
            result.map(gene => {
                document.getElementById("id").innerHTML +=
                    `
                        <div>
                            <span>${gene.id}</span>
                        </div>
                    `
                document.getElementById("position").innerHTML +=
                    `
                        <div>
                            <span>${gene.pos}</span>
                        </div>
                    `
                document.getElementById("alleles").innerHTML +=
                    `
                        <div>
                            <span>${gene.alleles[0]} ${gene.alleles[1]}</span>
                        </div>
                    `
                })

                let input = document.getElementById("gene-name");
                input.value = '';
                
                })
                .catch(error => console.log('error', error))
                    
        }


        

        

        

    }

    

  </script>
